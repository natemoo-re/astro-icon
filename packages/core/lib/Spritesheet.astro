---
import { SPRITESHEET_NAMESPACE } from './constants';
import load from './utils.ts';
import { getUsedSprites } from './context.ts';
import { Optimize } from './Props.ts';

export interface Props {
    optimize?: Optimize;
}

const { optimize = true, style, ...props } = Astro.props;
// @ts-ignore
const names = getUsedSprites($$result);
const icons = await Promise.all(names.map(name => {
    return load(name, {}, optimize).then(res => ({ ...res, name }));
}));
---

<svg style={`display: none; ${style ?? ''}`.trim()} {...{ 'aria-hidden': true, ...props }} astro-icon-spritesheet>
    {icons.map(icon => (
        <symbol {...icon.props} id={`${SPRITESHEET_NAMESPACE}:${icon.name}`}>
            {icon.innerHTML}
        </symbol>
    ))}
</svg>
